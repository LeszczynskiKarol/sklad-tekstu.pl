---
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import SEO from '../components/SEO.astro';
import CookieBanner from '../components/CookieBanner.astro';
import '../styles/global.css';

interface Props {
  title: string;
  description: string;
  canonical?: string;
  ogImage?: string;
  ogType?: 'website' | 'article';
  keywords?: string;
  noindex?: boolean;
  schema?: object;
}

const {
  title,
  description,
  canonical,
  ogImage,
  ogType,
  keywords,
  noindex,
  schema
} = Astro.props;
---

<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <meta name="theme-color" content="#1a1a1a" />

  <SEO
    title={title}
    description={description}
    canonical={canonical}
    ogImage={ogImage}
    ogType={ogType}
    keywords={keywords}
    noindex={noindex}
    schema={schema}
  />

  <!-- Preconnect -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="preconnect" href="https://www.googletagmanager.com" />
  <link rel="preconnect" href="https://www.google-analytics.com" />
</head>
<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript>
    <iframe
      src="https://www.googletagmanager.com/ns.html?id=GTM-WF37N7DQ"
      height="0"
      width="0"
      style="display:none;visibility:hidden"
      title="Google Tag Manager"
    ></iframe>
  </noscript>

  <Header />

  <main id="main-content" class="main-content">
    <slot />
  </main>

  <Footer />

  <!-- Cookie Consent Banner (GDPR) -->
  <CookieBanner />

  <!-- Back to top -->
  <button
    id="back-to-top"
    class="back-to-top"
    aria-label="Przewiń do góry"
    title="Przewiń do góry"
  >
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="18 15 12 9 6 15"></polyline>
    </svg>
  </button>

  <style>
    .main-content {
      margin-top: 52px;
      min-height: calc(100vh - 52px);
    }

    .back-to-top {
      position: fixed;
      bottom: var(--space-6);
      right: var(--space-6);
      width: 42px;
      height: 42px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--ink);
      color: var(--paper);
      border: 1px solid var(--rule);
      border-radius: var(--radius-sm);
      cursor: pointer;
      opacity: 0;
      visibility: hidden;
      transform: translateY(16px);
      transition: all var(--transition-base);
      z-index: 99;
    }

    .back-to-top.visible {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .back-to-top:hover {
      background: var(--accent);
      transform: translateY(-2px);
    }
  </style>

  <script>
    function initBackToTop() {
      const btn = document.getElementById('back-to-top');

      function toggle() {
        if (window.scrollY > 400) {
          btn?.classList.add('visible');
        } else {
          btn?.classList.remove('visible');
        }
      }

      window.addEventListener('scroll', toggle, { passive: true });
      btn?.addEventListener('click', () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
      toggle();
    }

    initBackToTop();
    document.addEventListener('astro:after-swap', initBackToTop);
  </script>

  <!-- Scroll reveal observer -->
  <script>
    function initReveal() {
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
          }
        });
      }, {
        threshold: 0.12,
        rootMargin: '0px 0px -30px 0px'
      });

      document.querySelectorAll('.reveal, .reveal-left, .reveal-right').forEach(el => {
        observer.observe(el);
      });
    }

    initReveal();
    document.addEventListener('astro:after-swap', initReveal);
  </script>
</body>
</html>